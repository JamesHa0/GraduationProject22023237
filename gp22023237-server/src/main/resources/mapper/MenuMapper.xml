<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jameshao.gp22023237.mapper.MenuMapper">

    <resultMap id="BaseResultMap" type="com.jameshao.gp22023237.po.Menu">
            <id property="id" column="id" />
            <result property="menusIndex" column="menus_index" />
            <result property="title" column="title" />
            <result property="icon" column="icon" />
            <result property="path" column="path" />
            <result property="parentId" column="parent_id" />
        <collection property="children" select="selectbypid" column="id" ofType="menu" fetchType="lazy"/>
    </resultMap>

    <sql id="Base_Column_List">
        id,menus_index,title,icon,path,parent_id
    </sql>

    <select id="selectbypid" resultMap="BaseResultMap">
        select * from menu where parent_id = #{id}
    </select>

    <select id="selectbyroleid" resultMap="BaseResultMap">
        select menu.* from menu, role_menu
        where parent_id = 0
          and menu.id = role_menu.menu_id
          and role_menu.role_id=#{roleid}
    </select>
</mapper>
